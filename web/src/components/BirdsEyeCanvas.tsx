import type { LotSummary, Stall } from '../lib/types'
function colorFor(s: Stall['status']){if(s==='open')return'rgba(34,197,94,0.45)';if(s==='occupied')return'rgba(220,38,38,0.45)';return'rgba(107,114,128,0.3)'}
export default function BirdsEyeCanvas({ lot, stalls }:{ lot:LotSummary, stalls:Stall[] }){const src=lot.latestImage?.url?(import.meta.env.VITE_API_BASE||'http://localhost:4000')+lot.latestImage.url:'';return(<div className='relative w-full h-full select-none' style={{background:'#f4f4f5'}}>{src?<img src={src} className='absolute inset-0 w-full h-full object-contain'/>:<div className='absolute inset-0 flex items-center justify-center'>No image</div>}<svg className='absolute inset-0 w-full h-full'>{stalls.map(stall=>(<polygon key={stall.id} points={stall.polygon.map(p=>p.join(',')).join(' ')} fill={colorFor(stall.status)} stroke='black' strokeWidth={1}/>))}</svg><div className='absolute top-2 right-2 bg-white/90 rounded px-2 py-1 text-xs shadow'>Updated: {lot.latestImage?new Date(lot.latestImage.captured_at).toLocaleString():'—'} • Source: {lot.latestImage?.source||'—'}</div></div>) }
